<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>提报主题列表</title>
    <script type="text/javascript" src="../js/jquery.js"></script>
    <script type="text/javascript" src="../js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../js/hi-utils.js"></script>
    <link rel="stylesheet" href="../css/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="../css/hi-main.css"/>
</head>
<script language=JavaScript>
$(function () {
    loadServerList(1,4);
    $("#searchBtn").click(function () {
        $
        console.log($("#startDate").val())
        console.log($("#endDate").val())
    })
    $("#addNew").click(function () {
        window.location="topicDetail.html?opera=add"
    })
    $("#prePage").click(function () {
        if($("#currentPage").html()>1){
            loadServerList(parseInt($("#currentPage").html())-1, 4);
        }
    })
    $("#firstPage").click(function () {
        if($("#currentPage").html()>1){
            loadServerList(1, 4);
        }
    })
    $("#lastPage").click(function () {
        loadServerList($("#totalPage").html(), 4);
    })
    $("#nextPage").click(function () {
        if($("#currentPage").html()<$("#totalPage").html()){
            loadServerList(parseInt($("#currentPage").html())+1, 4);
        }
    })
})
loadServerList= function(page, status) {
    var jsonParam="{page:"+page+",status:"+status+"}";
    $.ajax({
        type: "get",
        url: "/serverestimate/topicController/getTopicList",
        data: {jsonParam: jsonParam},
        async: true,
        success: function (data) {
            if(data){
                var sourceData = eval('(' + data + ')');
                $("#totalPage").html(sourceData.totalPage)
                $("#currentPage").html(sourceData.currentPage)
                if (sourceData.list && sourceData.list.length > 0) {
                    addRows(sourceData.list);
                }
            }else{
                $("#totalPage").html(0);
                $("#tbMain").html("");
            }
        },
        error: function (result) {
            console.log("failed")
        }
    });
}

addRows=function(topicList){
    var html  ="";
    for(var i=0;i<topicList.length;i++){
        var topic=topicList[i];
        html +=     "<tr  onmouseover='addclass(this)' onmouseout='removeclass(this)'>";
        html +=     "<td>" +(i+1)+ "</td>";
        html +=     "<td>" + topic.title+ "</td>";
        html +=     "<td>" + topic.percentStr + "</td>";
        html +=     "<td>" + (new Date(topic.dealDate)).Format("yyyy-MM-dd") + "</td>";
        html +=     "<td>" +new Date(topic.createDate).Format("yyyy-MM-dd hh:mm")+"</td>";
        html +=     "<td>"
            + "<a href='topicDetail.html?opera=view&id="+topic.id+"'>查看</a>"
            +"<a href='#'onclick='deleteTopicDialog(" +'"'+ topic.id +'"'+ ")'>删除</a>"
            + "<a href='topicDetail.html?opera=clone&id="+topic.id+"'>克隆</a>"
            + "<a href='topicScheduleList.html?id="+topic.id+"'>进度详情</a>"
            +"<a href='#'onclick='downloadCheckedData(" +'"'+ topic.id +'"'+ ")'>数据汇总</a>"
            + "</td>";
        html += "</tr>";
    }
    $("#tbMain").html(html);
}
deleteTopicDialog=function(topicId){
    $("#confirmDialog").dialog({
        height:200,
        width:400,
        resizable: false,
        buttons: {
            "确定": function() {
                deleteTopic(topicId);
                $( this ).dialog( "close" );
            },
            "取消": function() {
                $( this ).dialog( "close" );
            }
        }
    });
}
deleteTopic=function(topicId){
    $.ajax({
        type: "get",
        url: "/serverestimate/topicController/deleteTopicById",
        data: {jsonParam: topicId},
        async: true,
        success: function (data) {
            if(data=="success"){
                loadServerList(1, 4);
            }else{
                alert("删除失败")
            }
        },
        error: function (result) {
            console.log("failed")
        }
    });
}
downloadModel=function(topicId){
    window.location="/serverestimate/taskController/downloadModelAll?topicId="+topicId;
}
downloadCheckedData=function (topicId) {
    window.location="/serverestimate/taskController/downloadCheckedData?topicId="+topicId;
}
</script>

<body>
    <div class="toolbar">
        <h4>提报主题列表</h4>
    </div>
    <div class="list-button"><span class="addBtn" id="addNew">添加主题</span></div>
    <div class="list-table">
        <table width="95%" align="center" >
            <tr >
                <th width="5%">序号</th>
                <th width="25%">标题</th>
                <th width="7%">完成进度</th>
                <th width="10%">截止日期</th>
                <th width="15%">创建时间</th>
                <th width="35%">操作</th>
            </tr>
            <tbody id="tbMain">
            </tbody>
        </table>
    </div>
    <div class="pagebutton">
        <span class="pageClass"><span id="currentPage">1</span>/<span id="totalPage">5</span></span>
        <a href="#" id="firstPage">首页</a>  <a href="#" id="prePage">上一页</a>
        <a id="nextPage" href="#">下一页</a>  <a id="lastPage" href="#" >末页</a>

    </div>
    <div id="confirmDialog" style="display:none;" title="系统提示">
        <p align="center">删除后无法恢复，确定删除吗？</p>
    </div>

</body>
</html>
